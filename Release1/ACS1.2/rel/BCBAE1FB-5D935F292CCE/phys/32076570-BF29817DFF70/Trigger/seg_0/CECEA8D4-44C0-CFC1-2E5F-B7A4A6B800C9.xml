<?xml version = '1.0' encoding = 'UTF-8'?>
<TriggerOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.TriggerOraclev10g" name="SADER1_AUTO_FINISH" directorySegmentName="seg_0" id="CECEA8D4-44C0-CFC1-2E5F-B7A4A6B800C9">
<sourceConnName>osd11g</sourceConnName>
<sourceObjSchema>OSD</sourceObjSchema>
<sourceObjName>SADER1_AUTO_FINISH</sourceObjName>
<createdBy>Administrator</createdBy>
<createdTime>2014-12-02 09:16:55 UTC</createdTime>
<ownerDesignName>ACS1.2</ownerDesignName>
<actions>INSERT</actions>
<body>declare&lt;br/&gt;&lt;br/&gt;    emp_act_count number;&lt;br/&gt;    v_count       number;&lt;br/&gt;    v_serial      number;&lt;br/&gt;    &lt;br/&gt;begin&lt;br/&gt;  &lt;br/&gt;  select count(*) into v_count&lt;br/&gt;  from  osd.employee_actions&lt;br/&gt;  where process_no = :new.process_no&lt;br/&gt;  and year = :new.year&lt;br/&gt;  and status IS NULL;&lt;br/&gt;  &lt;br/&gt;  -----------------------------------&lt;br/&gt;  select max(serial_no)  into   v_serial&lt;br/&gt;  from   osd.AUTO_RECIEVED&lt;br/&gt;  where  PROCESS_NO = :new.PROCESS_NO;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;    if inserting then  &lt;br/&gt;    &lt;br/&gt;      if v_count &gt; 0 then &lt;br/&gt;         &lt;br/&gt;       update osd.employee_actions &lt;br/&gt;       set finished_date_dd = substr(MAIN.m2h(sysdate),9,2), &lt;br/&gt;           finished_date_mm = substr(MAIN.m2h(sysdate),6,2), &lt;br/&gt;           finished_date_yy = substr(MAIN.m2h(sysdate),1,4), &lt;br/&gt;           action_code = 40, &lt;br/&gt;           STATUS = 2,  --  finished  &lt;br/&gt;           site = 10001 -- ??????? ?????&lt;br/&gt;       where process_no = :new.process_no&lt;br/&gt;       and year = :new.year&lt;br/&gt;       and status IS NULL;&lt;br/&gt;                  &lt;br/&gt;      end if;&lt;br/&gt;     &lt;br/&gt;     ---------------------------------------------------------&lt;br/&gt;          &lt;br/&gt;      update osd.AUTO_RECIEVED&lt;br/&gt;      set REC_DATE = main.m2h(sysdate), &lt;br/&gt;          REC_USER = 10000,  -- ???????? ????? &lt;br/&gt;          REC_DONE_DATE = sysdate, &lt;br/&gt;          rec_no = 0,&lt;br/&gt;          rec_flag = 1,&lt;br/&gt;          SENT_NO = 1&lt;br/&gt;      where PROCESS_NO = :new.PROCESS_NO&lt;br/&gt;      and serial_no = v_serial&lt;br/&gt;      and rec_flag = 0;&lt;br/&gt;              &lt;br/&gt;    end if;&lt;br/&gt;        &lt;br/&gt;exception &lt;br/&gt;  when no_data_found then null;&lt;br/&gt;end; </body>
<triggerTime>AFTER</triggerTime>
<owner>C5730B64-FB4D-9F2E-CCB9-0672373953FB</owner>
<table>F6DF1704-124E-F124-5C6F-6691F05E266C</table>
</TriggerOraclev10g>