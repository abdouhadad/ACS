<?xml version = '1.0' encoding = 'UTF-8'?>
<TriggerOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.TriggerOraclev10g" name="PROS_STAT_CMD" directorySegmentName="seg_0" id="F2CB7F6E-2E32-7AB7-FC0C-211251CEB4D6">
<sourceConnName>osd11g</sourceConnName>
<sourceObjSchema>OSD</sourceObjSchema>
<sourceObjName>PROS_STAT_CMD</sourceObjName>
<createdBy>Administrator</createdBy>
<createdTime>2014-12-02 09:16:55 UTC</createdTime>
<ownerDesignName>ACS1.2</ownerDesignName>
<actions>INSERT, UPDATE, DELETE</actions>
<body>DECLARE&lt;br/&gt;&lt;br/&gt;/* &lt;br/&gt;???? ?????? ?????? ???????? ?? ???? osd.process_status  &lt;br/&gt;&lt;br/&gt;This trigger to log actions into  osd.process_status  table &lt;br/&gt;*/ &lt;br/&gt;&lt;br/&gt;    v_serial        number;&lt;br/&gt;    v_action        number;&lt;br/&gt;    v_in_date       varchar2(10);&lt;br/&gt;    v_department    varchar2(10);&lt;br/&gt;    v_dept          number;&lt;br/&gt;    v_log_count     number;&lt;br/&gt;    v_current       varchar2(10);&lt;br/&gt;    v_sent_user     number;&lt;br/&gt;    v_rec_user      number;&lt;br/&gt;    v_rec_date      varchar2(10);&lt;br/&gt;    v_rec           number;&lt;br/&gt;    v_from_dept     number;&lt;br/&gt;    v_to_dept       number;&lt;br/&gt;    &lt;br/&gt;BEGIN&lt;br/&gt;&lt;br/&gt;    IF DBMS_REPUTIL.FROM_REMOTE = FALSE THEN    &lt;br/&gt;        &lt;br/&gt;        if inserting then&lt;br/&gt;        &lt;br/&gt;            update osd.process_status set&lt;br/&gt;                action_code = :new.action_code,&lt;br/&gt;                in_date = :new.in_date_yy||&apos;/&apos;||LPAD (TO_CHAR(:new.in_date_mm),2,&apos;0&apos;)||&apos;/&apos;||LPAD(TO_CHAR (:new.in_date_dd),2,&apos;0&apos;),&lt;br/&gt;                department_no = :new.department_no,&lt;br/&gt;                dept_code = :new.recieved_to_code,&lt;br/&gt;                sent_user = :new.user_id,&lt;br/&gt;                rec_user = null,&lt;br/&gt;                rec_date = null,&lt;br/&gt;                time_flag = sysdate,&lt;br/&gt;                log_count = :new.serial_no,&lt;br/&gt;                current_dept = :new.department_no,&lt;br/&gt;                mail_flag = 0&lt;br/&gt;            where process_no = :new.process_no;&lt;br/&gt;            &lt;br/&gt;        elsif updating then&lt;br/&gt;        &lt;br/&gt;            update osd.process_status set&lt;br/&gt;                action_code = :new.action_code,&lt;br/&gt;                in_date = :new.in_date_yy||&apos;/&apos;||LPAD (TO_CHAR(:new.in_date_mm),2,&apos;0&apos;)||&apos;/&apos;||LPAD(TO_CHAR (:new.in_date_dd),2,&apos;0&apos;),&lt;br/&gt;                department_no = :new.department_no,&lt;br/&gt;                dept_code = :new.recieved_to_code,&lt;br/&gt;                sent_user = :new.user_id,&lt;br/&gt;                time_flag = sysdate,&lt;br/&gt;                log_count = :new.serial_no&lt;br/&gt;            where process_no = :old.process_no&lt;br/&gt;            and log_count = :old.serial_no;&lt;br/&gt;        &lt;br/&gt;        /*&lt;br/&gt;        elsif deleting then null;&lt;br/&gt;                                &lt;br/&gt;              select max(serial_no)  into v_serial&lt;br/&gt;              from osd.comm_all&lt;br/&gt;              where process_no = :old.process_no ;&lt;br/&gt;&lt;br/&gt;               begin&lt;br/&gt;                    select  action_code ,&lt;br/&gt;                            in_date_yy||&apos;/&apos;||LPAD (TO_CHAR(in_date_mm),2,&apos;0&apos;)||&apos;/&apos;||LPAD(TO_CHAR (in_date_dd),2,&apos;0&apos;), &lt;br/&gt;                            department_no,&lt;br/&gt;                            dept_code,&lt;br/&gt;                            serial_no&lt;br/&gt;                    into    v_action,&lt;br/&gt;                            v_in_date,&lt;br/&gt;                            v_department,&lt;br/&gt;                            v_dept,&lt;br/&gt;                            v_log_count&lt;br/&gt;                   from osd.comm_all&lt;br/&gt;                   where process_no = :old.process_no &lt;br/&gt;                   and serial_no = v_serial;&lt;br/&gt;               exception&lt;br/&gt;                when no_data_found then null;&lt;br/&gt;               end;&lt;br/&gt;               &lt;br/&gt;               ---------------------------------------&lt;br/&gt;               &lt;br/&gt;               begin&lt;br/&gt;                    select rec_flag, rec_date,   sent_user,     rec_user,    from_dept,        to_dept   &lt;br/&gt;                    into   v_rec,    v_rec_date, v_sent_user,   v_rec_user,  v_from_dept,      v_to_dept&lt;br/&gt;                    from osd.auto_recieved&lt;br/&gt;                    where process_no = :old.process_no&lt;br/&gt;                    and serial_no = v_serial ;&lt;br/&gt;               exception&lt;br/&gt;                    when no_data_found then  null;&lt;br/&gt;               end;&lt;br/&gt;              &lt;br/&gt;               if v_rec = 0     then     &lt;br/&gt;                &lt;br/&gt;                    v_current   := v_from_dept;&lt;br/&gt;                    v_sent_user := v_sent_user;&lt;br/&gt;                    v_rec_user  := null;&lt;br/&gt;                &lt;br/&gt;               elsif v_rec = 1  then     &lt;br/&gt;                &lt;br/&gt;                    v_current   := v_to_dept;&lt;br/&gt;                    v_sent_user := v_sent_user;&lt;br/&gt;                    v_rec_user  := v_rec_user;&lt;br/&gt;               &lt;br/&gt;               end if;&lt;br/&gt;              &lt;br/&gt;              ---------------------------------------&lt;br/&gt;                      &lt;br/&gt;              update osd.process_status set&lt;br/&gt;                      action_code   = v_action,&lt;br/&gt;                      in_date       = v_in_date,&lt;br/&gt;                      department_no = v_department,&lt;br/&gt;                      dept_code     = v_dept,&lt;br/&gt;                      log_count     = v_log_count,        &lt;br/&gt;              &lt;br/&gt;                      current_dept  = v_current,&lt;br/&gt;                      sent_user     = v_sent_user,&lt;br/&gt;                      rec_user      = v_rec_user,&lt;br/&gt;                      rec_date      = v_rec_date&lt;br/&gt;               where process_no = :old.process_no;                      &lt;br/&gt;        */&lt;br/&gt;        end if; &lt;br/&gt;        &lt;br/&gt;    end if; &lt;br/&gt;                      &lt;br/&gt;exception&lt;br/&gt;    when no_data_found then null;&lt;br/&gt;END; </body>
<triggerTime>AFTER</triggerTime>
<owner>C5730B64-FB4D-9F2E-CCB9-0672373953FB</owner>
<table>965CB31A-1597-B0A4-E8E3-52FCD080D48B</table>
</TriggerOraclev10g>