<?xml version = '1.0' encoding = 'UTF-8'?>
<TriggerOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.TriggerOraclev10g" name="NOTIFY_SADER" directorySegmentName="seg_0" id="A9B44CAC-600A-4F46-4FD2-FC49E8F464CB">
<sourceConnName>osd11g</sourceConnName>
<sourceObjSchema>OSD</sourceObjSchema>
<sourceObjName>NOTIFY_SADER</sourceObjName>
<createdBy>Administrator</createdBy>
<createdTime>2014-12-02 09:16:55 UTC</createdTime>
<ownerDesignName>ACS1.1</ownerDesignName>
<actions>INSERT</actions>
<body>DECLARE  &lt;br/&gt;   count_cm   NUMBER;&lt;br/&gt;   count_wr   NUMBER;&lt;br/&gt;   count_n    NUMBER;&lt;br/&gt;   v_mobile   VARCHAR2(15);&lt;br/&gt;   v_email    VARCHAR2(100);&lt;br/&gt;   count_s    number;&lt;br/&gt;BEGIN&lt;br/&gt;&lt;br/&gt; IF DBMS_REPUTIL.FROM_REMOTE = FALSE THEN&lt;br/&gt; &lt;br/&gt;      IF INSERTING THEN&lt;br/&gt;      &lt;br/&gt;        SELECT COUNT(*) INTO count_cm&lt;br/&gt;        FROM osd.COMM_MASTER &lt;br/&gt;        WHERE  process_no = :NEW.process_no&lt;br/&gt;        AND    YEAR = :NEW.YEAR &lt;br/&gt;        AND    (mobile_no IS NOT NULL OR e_mail IS NOT NULL);&lt;br/&gt;       &lt;br/&gt;        SELECT COUNT(*) INTO count_wr&lt;br/&gt;        FROM osd.WOMEN_REQUEST&lt;br/&gt;        WHERE  process_no = :NEW.process_no&lt;br/&gt;        AND   from_mobile IS NOT NULL ;&lt;br/&gt;        &lt;br/&gt;        select count(*) into count_s&lt;br/&gt;        from osd.NOTIFY&lt;br/&gt;        where sader_no = :new.sader_no&lt;br/&gt;        and year = :new.year; &lt;br/&gt;       &lt;br/&gt;        IF count_cm = 1 and count_s = 0 THEN&lt;br/&gt;        &lt;br/&gt;          SELECT mobile_no ,e_mail  INTO   v_mobile, v_email&lt;br/&gt;          FROM   osd.COMM_MASTER&lt;br/&gt;          WHERE  process_no = :NEW.process_no&lt;br/&gt;          AND    YEAR = :NEW.YEAR ;&lt;br/&gt;         &lt;br/&gt;          INSERT INTO osd.NOTIFY(PROCESS_NO,YEAR,SADER_NO,MOBILE_NO,E_MAIL,FINISHED,NOTIFIED)&lt;br/&gt;          VALUES (:NEW.process_no,:NEW.YEAR,:NEW.sader_no,TO_NUMBER(v_mobile),v_email,1,0);&lt;br/&gt;          &lt;br/&gt;        ELSIF  count_wr = 1 and count_s = 0 THEN&lt;br/&gt;        &lt;br/&gt;         SELECT from_mobile   INTO   v_mobile&lt;br/&gt;         FROM   osd.WOMEN_REQUEST&lt;br/&gt;         WHERE  process_no = :NEW.process_no ;&lt;br/&gt;         &lt;br/&gt;         INSERT INTO osd.NOTIFY(PROCESS_NO,YEAR,SADER_NO,MOBILE_NO,FINISHED,NOTIFIED)&lt;br/&gt;         VALUES (:NEW.process_no,:NEW.YEAR,:NEW.sader_no,TO_NUMBER(v_mobile),1,0);&lt;br/&gt;         &lt;br/&gt;        END IF;&lt;br/&gt;        &lt;br/&gt;        SELECT COUNT(*) INTO count_n&lt;br/&gt;        FROM osd.NOTIFY&lt;br/&gt;        WHERE process_no = :NEW.process_no&lt;br/&gt;        AND YEAR = :NEW.YEAR ;&lt;br/&gt;        &lt;br/&gt;        IF count_n &gt; 0 THEN&lt;br/&gt;             &lt;br/&gt;         UPDATE osd.NOTIFY &lt;br/&gt;         SET sader_no = :NEW.sader_no , FINISHED =1&lt;br/&gt;         WHERE process_no = :NEW.process_no&lt;br/&gt;         AND YEAR = :NEW.YEAR ;&lt;br/&gt;             &lt;br/&gt;        END IF;&lt;br/&gt;       &lt;br/&gt;      END IF;&lt;br/&gt;  &lt;br/&gt; END IF;&lt;br/&gt;&lt;br/&gt;END; </body>
<triggerTime>AFTER</triggerTime>
<owner>C5730B64-FB4D-9F2E-CCB9-0672373953FB</owner>
<table>B67109F4-FDBC-1061-94D8-288B92E08BE8</table>
</TriggerOraclev10g>