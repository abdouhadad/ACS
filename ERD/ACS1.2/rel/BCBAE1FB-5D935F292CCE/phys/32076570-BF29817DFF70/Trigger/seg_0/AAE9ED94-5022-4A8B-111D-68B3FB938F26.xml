<?xml version = '1.0' encoding = 'UTF-8'?>
<TriggerOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.TriggerOraclev10g" name="AUTO_RECIEVED_DTL" directorySegmentName="seg_0" id="AAE9ED94-5022-4A8B-111D-68B3FB938F26">
<sourceConnName>osd11g</sourceConnName>
<sourceObjSchema>OSD</sourceObjSchema>
<sourceObjName>AUTO_RECIEVED_DTL</sourceObjName>
<createdBy>Administrator</createdBy>
<createdTime>2014-12-02 09:16:55 UTC</createdTime>
<ownerDesignName>ACS1.1</ownerDesignName>
<actions>INSERT, UPDATE, DELETE</actions>
<body>DECLARE&lt;br/&gt;    &lt;br/&gt;    v_location  number;&lt;br/&gt;    v_serial    number;&lt;br/&gt;    v_count     number;&lt;br/&gt;&lt;br/&gt;BEGIN&lt;br/&gt;&lt;br/&gt;    IF DBMS_REPUTIL.FROM_REMOTE = FALSE THEN&lt;br/&gt;       &lt;br/&gt;         if inserting then &lt;br/&gt;         &lt;br/&gt;         -------------------- ?????? ???? ??? ???????  ---------------------------   &lt;br/&gt;          begin  &lt;br/&gt;            select location into v_location&lt;br/&gt;            from main.departments&lt;br/&gt;            where department_no = :new.recieved_to_code;&lt;br/&gt;          exception&lt;br/&gt;            when no_data_found then v_location := 1;&lt;br/&gt;          end;&lt;br/&gt;          &lt;br/&gt;         -------------------- ?????? ????? ?? ?? ???? ?? ???? ???????? ????? -------   &lt;br/&gt;            begin&lt;br/&gt;                select count(*) into v_count&lt;br/&gt;                from osd.auto_recieved&lt;br/&gt;                where process_no = :new.process_no;&lt;br/&gt;                &lt;br/&gt;                if v_count &gt; 0 then&lt;br/&gt;                    select max(serial_no) +1 into v_serial&lt;br/&gt;                    from osd.auto_recieved&lt;br/&gt;                    where process_no = :new.process_no;&lt;br/&gt;                else&lt;br/&gt;                    v_serial := 0;&lt;br/&gt;                end if;&lt;br/&gt;            &lt;br/&gt;            end;  &lt;br/&gt;            &lt;br/&gt;            &lt;br/&gt;            &lt;br/&gt;              &lt;br/&gt;            ------------------------- ?????? ????? ????????? -------------------&lt;br/&gt;            if :new.recieved_to_code in (1201131015 ) then   -- ?????? &lt;br/&gt;            &lt;br/&gt;               INSERT INTO &quot;OSD&quot;.&quot;AUTO_RECIEVED&quot;&lt;br/&gt;                (PROCESS_NO,   year,    serial_no   , from_dept, to_dept,  &lt;br/&gt;                 sent_date, &lt;br/&gt;                 sent_user,  attachment ,REC_FLAG)&lt;br/&gt;               VALUES&lt;br/&gt;                (:NEW.PROCESS_NO , :new.year,     :new.serial_no  ,:NEW.DEPARTMENT_NO    ,:NEW.RECIEVED_TO_CODE,&lt;br/&gt;                 TO_CHAR(:new.IN_DATE_YY) ||&apos;/&apos;|| LPAD(:new.IN_DATE_MM,2,&apos;0&apos;) ||&apos;/&apos;||LPAD(:new.IN_DATE_DD,2,&apos;0&apos;) ,&lt;br/&gt;                 :NEW.USER_ID,:NEW.IN_ACCOMPANIED,0 );&lt;br/&gt;            &lt;br/&gt;            ------------------  ??????? ??????? = ??????? ??????? ????? ---------        &lt;br/&gt;            elsif :new.recieved_to_code = :new.department_no then&lt;br/&gt;                INSERT INTO &quot;OSD&quot;.&quot;AUTO_RECIEVED&quot;&lt;br/&gt;                (PROCESS_NO, year, serial_no, from_dept,   to_dept,  &lt;br/&gt;                 sent_date,  rec_date, &lt;br/&gt;                 sent_user,  attachment ,REC_FLAG, rec_done_date, rec_user)&lt;br/&gt;               VALUES&lt;br/&gt;                (:NEW.PROCESS_NO, :new.year,  v_serial, :NEW.DEPARTMENT_NO, :new.recieved_to_code,   &lt;br/&gt;                 TO_CHAR(:new.IN_DATE_YY) ||&apos;/&apos;|| LPAD(:new.IN_DATE_MM,2,&apos;0&apos;) ||&apos;/&apos;||LPAD(:new.IN_DATE_DD,2,&apos;0&apos;) ,&lt;br/&gt;                 TO_CHAR(:new.IN_DATE_YY) ||&apos;/&apos;|| LPAD(:new.IN_DATE_MM,2,&apos;0&apos;) ||&apos;/&apos;||LPAD(:new.IN_DATE_DD,2,&apos;0&apos;) ,&lt;br/&gt;                 :NEW.USER_ID,:NEW.IN_ACCOMPANIED, 1, sysdate, :new.user_id ); &lt;br/&gt;            &lt;br/&gt;            ------------------------- ????????? ??????? ??????? -----------------&lt;br/&gt;            elsif v_location not in (1, 5) THEN -- ????? ??????? ??????? ????? -- ??? ?????? ???? ?? ?????  &lt;br/&gt;            --or :new.recieved_to_code in (&apos;2010300000&apos;,&apos;2010302400&apos;,&apos;2010302000&apos;) then&lt;br/&gt;            &lt;br/&gt;               INSERT INTO &quot;OSD&quot;.&quot;AUTO_RECIEVED&quot;&lt;br/&gt;                (PROCESS_NO,  year,     serial_no, from_dept, to_dept,  &lt;br/&gt;                 sent_date,  &lt;br/&gt;                 rec_date, &lt;br/&gt;                 sent_user,  attachment, REC_FLAG, rec_done_date, rec_user)&lt;br/&gt;               VALUES&lt;br/&gt;                (:NEW.PROCESS_NO, :new.year, v_serial ,  :NEW.DEPARTMENT_NO,  :NEW.RECIEVED_TO_CODE,&lt;br/&gt;                 TO_CHAR(:new.IN_DATE_YY) ||&apos;/&apos;|| LPAD(:new.IN_DATE_MM,2,&apos;0&apos;) ||&apos;/&apos;||LPAD(:new.IN_DATE_DD,2,&apos;0&apos;),&lt;br/&gt;                 TO_CHAR(:new.IN_DATE_YY) ||&apos;/&apos;|| LPAD(:new.IN_DATE_MM,2,&apos;0&apos;) ||&apos;/&apos;||LPAD(:new.IN_DATE_DD,2,&apos;0&apos;),&lt;br/&gt;                 :NEW.USER_ID, :NEW.IN_ACCOMPANIED, 1, sysdate, 10000 );&lt;br/&gt;            &lt;br/&gt;            ------------------------- ????????? ??????? ?? ???? ?????? ???? ---------------&lt;br/&gt;            elsif :new.action_code in (32, 73, 84, 113) then  -- ??? ??? ??? -- ?? ????? -- ???????? -- ??? ??? -- &lt;br/&gt;               INSERT INTO &quot;OSD&quot;.&quot;AUTO_RECIEVED&quot;&lt;br/&gt;                (PROCESS_NO,  year,      serial_no, from_dept, to_dept,  &lt;br/&gt;                 sent_date,  &lt;br/&gt;                 rec_date, &lt;br/&gt;                 sent_user,  attachment, REC_FLAG, rec_done_date, rec_user)&lt;br/&gt;               VALUES&lt;br/&gt;                (:NEW.PROCESS_NO, :new.year, v_serial ,  :NEW.DEPARTMENT_NO,  :NEW.RECIEVED_TO_CODE,&lt;br/&gt;                 TO_CHAR(:new.IN_DATE_YY) ||&apos;/&apos;|| LPAD(:new.IN_DATE_MM,2,&apos;0&apos;) ||&apos;/&apos;||LPAD(:new.IN_DATE_DD,2,&apos;0&apos;),&lt;br/&gt;                 TO_CHAR(:new.IN_DATE_YY) ||&apos;/&apos;|| LPAD(:new.IN_DATE_MM,2,&apos;0&apos;) ||&apos;/&apos;||LPAD(:new.IN_DATE_DD,2,&apos;0&apos;),&lt;br/&gt;                 :NEW.USER_ID, :NEW.IN_ACCOMPANIED, 1, sysdate, 10000 ); &lt;br/&gt;            &lt;br/&gt;            ------------------------- ????? ??????? -----------------------------&lt;br/&gt;            else&lt;br/&gt;               &lt;br/&gt;               INSERT INTO &quot;OSD&quot;.&quot;AUTO_RECIEVED&quot;&lt;br/&gt;                (PROCESS_NO,   year,    serial_no   , from_dept, to_dept,  &lt;br/&gt;                 sent_date, &lt;br/&gt;                 sent_user,  attachment ,REC_FLAG)&lt;br/&gt;               VALUES&lt;br/&gt;                (:NEW.PROCESS_NO , :new.year,     :new.serial_no  ,:NEW.DEPARTMENT_NO    ,:NEW.RECIEVED_TO_CODE,&lt;br/&gt;                 TO_CHAR(:new.IN_DATE_YY) ||&apos;/&apos;|| LPAD(:new.IN_DATE_MM,2,&apos;0&apos;) ||&apos;/&apos;||LPAD(:new.IN_DATE_DD,2,&apos;0&apos;) ,&lt;br/&gt;                 :NEW.USER_ID,:NEW.IN_ACCOMPANIED,0 );&lt;br/&gt;            &lt;br/&gt;            end if;&lt;br/&gt;            &lt;br/&gt;            &lt;br/&gt;         -----------------------------   &lt;br/&gt;         elsif  updating  then &lt;br/&gt;         &lt;br/&gt;            update &quot;OSD&quot;.&quot;AUTO_RECIEVED&quot;&lt;br/&gt;            SET PROCESS_NO = :NEW.PROCESS_NO ,&lt;br/&gt;                serial_no  = :new.serial_no,  &lt;br/&gt;                from_dept  = :NEW.DEPARTMENT_NO, &lt;br/&gt;                to_dept    = :NEW.RECIEVED_TO_CODE, &lt;br/&gt;                sent_date  =  TO_CHAR(:new.IN_DATE_YY) ||&apos;/&apos;|| LPAD(:new.IN_DATE_MM,2,&apos;0&apos;) ||&apos;/&apos;||LPAD(:new.IN_DATE_DD,2,&apos;0&apos;) ,&lt;br/&gt;                sent_user  = :new.user_id,&lt;br/&gt;                attachment = :NEW.IN_ACCOMPANIED&lt;br/&gt;            WHERE PROCESS_NO =:OLD.PROCESS_NO&lt;br/&gt;            AND serial_no    =:OLD.serial_no ;&lt;br/&gt;         &lt;br/&gt;         &lt;br/&gt;         -----------------------------&lt;br/&gt;         elsif  deleting  then &lt;br/&gt;         &lt;br/&gt;            DELETE &quot;OSD&quot;.&quot;AUTO_RECIEVED&quot;&lt;br/&gt;            WHERE PROCESS_NO=:OLD.PROCESS_NO&lt;br/&gt;            and serial_no = :old.serial_no;&lt;br/&gt;         &lt;br/&gt;         end if;&lt;br/&gt;    end if;&lt;br/&gt;END ; </body>
<triggerTime>AFTER</triggerTime>
<owner>C5730B64-FB4D-9F2E-CCB9-0672373953FB</owner>
<table>965CB31A-1597-B0A4-E8E3-52FCD080D48B</table>
</TriggerOraclev10g>