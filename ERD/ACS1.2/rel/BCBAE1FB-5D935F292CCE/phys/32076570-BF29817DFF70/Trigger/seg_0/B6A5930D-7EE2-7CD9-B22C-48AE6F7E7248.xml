<?xml version = '1.0' encoding = 'UTF-8'?>
<TriggerOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.TriggerOraclev10g" name="COMM_SADER_NO" directorySegmentName="seg_0" id="B6A5930D-7EE2-7CD9-B22C-48AE6F7E7248">
<sourceConnName>osd11g</sourceConnName>
<sourceObjSchema>OSD</sourceObjSchema>
<sourceObjName>COMM_SADER_NO</sourceObjName>
<createdBy>Administrator</createdBy>
<createdTime>2014-12-02 09:16:55 UTC</createdTime>
<ownerDesignName>ACS1.1</ownerDesignName>
<actions>INSERT, DELETE</actions>
<body>DECLARE&lt;br/&gt;   Exec_Sader  EXCEPTION;&lt;br/&gt;   counter      NUMBER       := 0;&lt;br/&gt;   v_mod_date varchar2(11);&lt;br/&gt; BEGIN&lt;br/&gt; &lt;br/&gt;  select main.m2h(sysdate) into v_mod_date from dual; &lt;br/&gt;   &lt;br/&gt;   &lt;br/&gt;   IF  DBMS_REPUTIL.FROM_REMOTE  = FALSE THEN&lt;br/&gt;     &lt;br/&gt;     IF INSERTING   THEN&lt;br/&gt;     ----------------  Employee_Decisions -----------------------&lt;br/&gt;      counter := 0;&lt;br/&gt;      SELECT COUNT (*)     INTO counter&lt;br/&gt;      FROM hrms.employee_decisions&lt;br/&gt;      WHERE process_no = :NEW.process_no         AND YEAR = :NEW.YEAR&lt;br/&gt;      AND sader_no IS NULL;&lt;br/&gt;      &lt;br/&gt;      IF counter &lt;&gt; 0  THEN&lt;br/&gt;         UPDATE hrms.employee_decisions    &lt;br/&gt;		 SET sader_no = :NEW.sader_no, &lt;br/&gt;             sader_date =  LPAD (NVL (:NEW.sader_date_yy, 1424), 4, 0)||&apos;/&apos;||LPAD (NVL (:NEW.sader_date_mm, 1), 2, 0)||&apos;/&apos;||LPAD (NVL (:NEW.sader_date_dd, 1), 2, 0),&lt;br/&gt;             date_modified  =  TO_DATE (TO_CHAR (SYSDATE, &apos;yyyy-mm-dd hh24:mi&apos;),&apos;yyyy-mm-dd hh24:mi&apos;)&lt;br/&gt;         WHERE process_no = :NEW.process_no   &lt;br/&gt;         AND YEAR = :NEW.YEAR&lt;br/&gt;         AND sader_no IS NULL;&lt;br/&gt;         &lt;br/&gt;         UPDATE hrms.employee_decisions    &lt;br/&gt;		 SET EFFECTIVE_DATE =  LPAD (NVL (:NEW.sader_date_yy, 1424), 4, 0)||&apos;/&apos;||LPAD (NVL (:NEW.sader_date_mm, 1), 2, 0)||&apos;/&apos;||LPAD (NVL (:NEW.sader_date_dd, 1), 2, 0),&lt;br/&gt;             date_modified  =  TO_DATE (TO_CHAR (SYSDATE, &apos;yyyy-mm-dd hh24:mi&apos;),&apos;yyyy-mm-dd hh24:mi&apos;)&lt;br/&gt;         WHERE process_no = :NEW.process_no   &lt;br/&gt;         AND YEAR = :NEW.YEAR&lt;br/&gt;         AND UPDATE_FLAG = 1&lt;br/&gt;         AND DECISION_CODE = 6&lt;br/&gt;         AND WAS_EXECUTED_DECISION = 0;&lt;br/&gt;      END IF;&lt;br/&gt;     ----------------   Employee_Decisions   ------------------   &lt;br/&gt;     &lt;br/&gt;     ----------------  Emp_Abs -----------------------&lt;br/&gt;      counter := 0;&lt;br/&gt;      SELECT COUNT (*)     INTO counter&lt;br/&gt;      FROM hrms.emp_abs_master&lt;br/&gt;      WHERE process_no = :NEW.process_no         AND process_YEAR = :NEW.YEAR&lt;br/&gt;      AND sader_no IS NULL;&lt;br/&gt;      &lt;br/&gt;      &lt;br/&gt;      &lt;br/&gt;      IF counter &lt;&gt; 0  THEN&lt;br/&gt;         UPDATE hrms.emp_abs_master   &lt;br/&gt;		 SET sader_no = :NEW.sader_no, &lt;br/&gt;             sader_date =  LPAD (NVL (:NEW.sader_date_yy, 1424), 4, 0)||&apos;/&apos;||LPAD (NVL (:NEW.sader_date_mm, 1), 2, 0)||&apos;/&apos;||LPAD (NVL (:NEW.sader_date_dd, 1), 2, 0),&lt;br/&gt;             EFFECTIVE_DATE =  LPAD (NVL (:NEW.sader_date_yy, 1424), 4, 0)||&apos;/&apos;||LPAD (NVL (:NEW.sader_date_mm, 1), 2, 0)||&apos;/&apos;||LPAD (NVL (:NEW.sader_date_dd, 1), 2, 0)&lt;br/&gt;         WHERE process_no = :NEW.process_no   &lt;br/&gt;         AND process_YEAR = :NEW.YEAR&lt;br/&gt;         AND sader_no IS NULL;&lt;br/&gt;         &lt;br/&gt;         UPDATE hrms.emp_abs    &lt;br/&gt;		 SET sader_no = :NEW.sader_no, &lt;br/&gt;             sader_date =  LPAD (NVL (:NEW.sader_date_yy, 1424), 4, 0)||&apos;/&apos;||LPAD (NVL (:NEW.sader_date_mm, 1), 2, 0)||&apos;/&apos;||LPAD (NVL (:NEW.sader_date_dd, 1), 2, 0),&lt;br/&gt;             EFFECTIVE_DATE =  LPAD (NVL (:NEW.sader_date_yy, 1424), 4, 0)||&apos;/&apos;||LPAD (NVL (:NEW.sader_date_mm, 1), 2, 0)||&apos;/&apos;||LPAD (NVL (:NEW.sader_date_dd, 1), 2, 0),&lt;br/&gt;             modified_date  = v_mod_date --TO_DATE (TO_CHAR (SYSDATE, &apos;yyyy-mm-dd hh24:mi&apos;),&apos;yyyy-mm-dd hh24:mi&apos;)&lt;br/&gt;         WHERE process_no = :NEW.process_no   &lt;br/&gt;         AND process_YEAR = :NEW.YEAR&lt;br/&gt;         AND sader_no IS NULL;&lt;br/&gt;				 &lt;br/&gt;      END IF;&lt;br/&gt;     ----------------   Emp_Abs  ------------------   &lt;br/&gt;&lt;br/&gt;     ----------------    Vacations &lt;br/&gt;      counter := 0;&lt;br/&gt;       SELECT COUNT (*)        INTO counter&lt;br/&gt;       FROM hrms.vacations&lt;br/&gt;       WHERE process_no = :NEW.process_no         AND YEAR = :NEW.YEAR&lt;br/&gt;       AND sader_no IS NULL;&lt;br/&gt;       &lt;br/&gt;      IF counter &lt;&gt; 0  THEN&lt;br/&gt;         UPDATE hrms.vacations    &lt;br/&gt;		 SET sader_no = :NEW.sader_no, &lt;br/&gt;		     sader_date =  LPAD (NVL (:NEW.sader_date_yy, 1424), 4, 0)||&apos;/&apos;|| LPAD (NVL (:NEW.sader_date_mm, 1), 2, 0)||&apos;/&apos;||LPAD (NVL (:NEW.sader_date_dd, 1), 2, 0),&lt;br/&gt;             date_modified  =  TO_DATE (TO_CHAR (SYSDATE, &apos;yyyy-mm-dd hh24:mi&apos;),&apos;yyyy-mm-dd hh24:mi&apos;)&lt;br/&gt;          WHERE process_no = :NEW.process_no   AND YEAR = :NEW.YEAR&lt;br/&gt;                 AND sader_no IS NULL;&lt;br/&gt;      END IF;&lt;br/&gt;     ----------------  Vacations &lt;br/&gt;&lt;br/&gt;     ----------------    FORMS_APPOINTMENT&lt;br/&gt;      counter := 0;&lt;br/&gt;       SELECT COUNT (*)        INTO counter&lt;br/&gt;       FROM hrms.FORMS_APPOINTMENT&lt;br/&gt;       WHERE process_no = :NEW.process_no&lt;br/&gt;       AND sader_no IS NULL;&lt;br/&gt;       &lt;br/&gt;      IF counter &lt;&gt; 0  THEN&lt;br/&gt;         UPDATE hrms.FORMS_APPOINTMENT&lt;br/&gt;		 SET sader_no = :NEW.sader_no, &lt;br/&gt;		     sader_date =  LPAD (NVL (:NEW.sader_date_yy, 1424), 4, 0)||&apos;/&apos;|| LPAD (NVL (:NEW.sader_date_mm, 1), 2, 0)||&apos;/&apos;||LPAD (NVL (:NEW.sader_date_dd, 1), 2, 0),&lt;br/&gt;             date_modified  =  TO_DATE (TO_CHAR (SYSDATE, &apos;yyyy-mm-dd hh24:mi&apos;),&apos;yyyy-mm-dd hh24:mi&apos;)&lt;br/&gt;          WHERE process_no = :NEW.process_no&lt;br/&gt;                 AND sader_no IS NULL;&lt;br/&gt;      END IF;&lt;br/&gt;     ----------------  Vacations &lt;br/&gt;     &lt;br/&gt;     ----------------  Temp_Employment &lt;br/&gt;      counter := 0;&lt;br/&gt;       SELECT COUNT (*)        INTO counter&lt;br/&gt;       FROM hrms.temp_employment&lt;br/&gt;       WHERE process_no = :NEW.process_no         AND YEAR = :NEW.YEAR&lt;br/&gt;       AND sader_no IS NULL;&lt;br/&gt;       IF counter &lt;&gt; 0   THEN&lt;br/&gt;         UPDATE hrms.temp_employment&lt;br/&gt;		 SET sader_no = :NEW.sader_no, &lt;br/&gt;		     sader_date =  LPAD (NVL (:NEW.sader_date_yy, 1424), 4, 0)||&apos;/&apos;||LPAD (NVL (:NEW.sader_date_mm, 1), 2, 0)||&apos;/&apos;||LPAD (NVL (:NEW.sader_date_dd, 1), 2, 0),&lt;br/&gt;             date_modified  =  TO_DATE (TO_CHAR (SYSDATE, &apos;yyyy-mm-dd hh24:mi&apos;),&apos;yyyy-mm-dd hh24:mi&apos;)&lt;br/&gt;          WHERE process_no = :NEW.process_no   AND YEAR = :NEW.YEAR&lt;br/&gt;          AND sader_no IS NULL;		&lt;br/&gt;				 &lt;br/&gt;       END IF;&lt;br/&gt;       &lt;br/&gt;      ----------------    Temp_Employment &lt;br/&gt;&lt;br/&gt;      &lt;br/&gt;      &lt;br/&gt;      -----------------   public_main    ----------------&lt;br/&gt;      counter := 0;&lt;br/&gt;      SELECT COUNT (*)     INTO counter&lt;br/&gt;      FROM laws.public_main&lt;br/&gt;      WHERE process_no = :NEW.process_no    AND public_no IS NULL;&lt;br/&gt;      &lt;br/&gt;       IF counter &lt;&gt; 0  THEN&lt;br/&gt;         UPDATE laws.public_main   &lt;br/&gt;		 SET public_no = :NEW.sader_no, &lt;br/&gt;             public_date =  LPAD (NVL (:NEW.sader_date_yy, 1424), 4, 0)||&apos;/&apos;||LPAD (NVL (:NEW.sader_date_mm, 1), 2, 0)||&apos;/&apos;||LPAD (NVL (:NEW.sader_date_dd, 1), 2, 0),&lt;br/&gt;             DATE_MODIFIED  =  TO_DATE (TO_CHAR (SYSDATE, &apos;yyyy-mm-dd hh24:mi&apos;),&apos;yyyy-mm-dd hh24:mi&apos;)&lt;br/&gt;         WHERE process_no = :NEW.process_no&lt;br/&gt;         AND public_no IS NULL;&lt;br/&gt;       END IF;&lt;br/&gt;     &lt;br/&gt;     ---------------------------------------------------------------------------------------------&lt;br/&gt;           /*    ELSIF UPDATING&lt;br/&gt;           THEN&lt;br/&gt;             counter := 0;&lt;br/&gt;             select count(*) into counter  from hrms.EMPLOYEE_DECISIONS&lt;br/&gt;             where process_no = :new.process_no and year = :new.year&lt;br/&gt;               and was_executed_decision = 1;&lt;br/&gt;               if counter &lt;&gt; 0 then raise executed_sader; end if;&lt;br/&gt;           ----------------------------------------------------------------------------------------		 &lt;br/&gt;             counter := 0;&lt;br/&gt;             select count(*) into counter   from hrms.VACATIONS&lt;br/&gt;             where process_no = :new.process_no and year = :new.year&lt;br/&gt;               and was_executed_decision = 1;&lt;br/&gt;               if counter &lt;&gt; 0 then raise executed_sader; end if;&lt;br/&gt;           ----------------------------------------------------------------------------------------		 &lt;br/&gt;            update hrms.EMPLOYEE_DECISIONS&lt;br/&gt;                    set SADER_NO = :new.SADER_NO,&lt;br/&gt;                           SADER_DATE = LPAD (:new.SADER_DATE_yy, 4, 0) || &apos;/&apos;|| LPAD (:new.SADER_DATE_mm, 2, 0) || &apos;/&apos;||&lt;br/&gt;                                                              LPAD (:new.SADER_DATE_dd, 2, 0), &lt;br/&gt;                   DATE_MODIFIED  =   TO_DATE (TO_CHAR (SYSDATE, &apos;yyyy-mm-dd hh24:mi&apos;),&apos;yyyy-mm-dd hh24:mi&apos;)&lt;br/&gt;                  --		 MODIFIED_USER_NO = &lt;br/&gt;           where process_no = :new.process_no and year = :new.year&lt;br/&gt;               and was_executed_decision &lt;&gt; 1;&lt;br/&gt;           ---------------------------------------------------------------------------------------&lt;br/&gt;            update hrms.VACATIONS&lt;br/&gt;                    set SADER_NO = :new.SADER_NO,&lt;br/&gt;                           SADER_DATE = LPAD (:new.SADER_DATE_yy, 4, 0) || &apos;/&apos;|| LPAD (:new.SADER_DATE_mm, 2, 0) || &apos;/&apos;||&lt;br/&gt;                                                              LPAD (:new.SADER_DATE_dd, 2, 0), &lt;br/&gt;                           DATE_MODIFIED  =   TO_DATE (TO_CHAR (SYSDATE, &apos;yyyy-mm-dd hh24:mi&apos;),&apos;yyyy-mm-dd hh24:mi&apos;)&lt;br/&gt;                  --		 MODIFIED_USER_NO = &lt;br/&gt;           where process_no = :new.process_no and year = :new.year&lt;br/&gt;               and was_executed_decision &lt;&gt; 1;*/&lt;br/&gt;           --------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;br/&gt;&lt;br/&gt;     ELSIF DELETING  THEN &lt;br/&gt;&lt;br/&gt;      -- her we will search for executed descisions with Sader number to stop deleting SADER_NO &lt;br/&gt;	  counter := 0;&lt;br/&gt;	    SELECT COUNT (*)   INTO  counter&lt;br/&gt;        FROM hrms.employee_decisions&lt;br/&gt;        WHERE process_no = :OLD.process_no&lt;br/&gt;	    AND YEAR   = :OLD.YEAR&lt;br/&gt;        AND sader_no  = :OLD.sader_no and was_executed_decision = 1;&lt;br/&gt;	    SELECT COUNT (*)   INTO counter&lt;br/&gt;        FROM hrms.vacations&lt;br/&gt;        WHERE process_no = :OLD.process_no&lt;br/&gt;	    AND YEAR  = :OLD.YEAR&lt;br/&gt;        AND sader_no  = :OLD.sader_no and was_executed_decision = 1;&lt;br/&gt;	    SELECT COUNT (*)  INTO counter&lt;br/&gt;        FROM hrms.temp_employment&lt;br/&gt;        WHERE process_no = :OLD.process_no&lt;br/&gt;	    AND YEAR  = :OLD.YEAR&lt;br/&gt;        AND sader_no   = :OLD.sader_no and was_executed_decision = 1;&lt;br/&gt;        &lt;br/&gt;		IF counter &lt;&gt; 0 then&lt;br/&gt;		   raise Exec_Sader; &lt;br/&gt;		end if;	  &lt;br/&gt;      ----------------    End   Checking	  &lt;br/&gt;      &lt;br/&gt;      ----------------    Employee_Decisions &lt;br/&gt;      SELECT COUNT (*)        INTO counter&lt;br/&gt;      FROM hrms.employee_decisions&lt;br/&gt;      WHERE process_no = :OLD.process_no&lt;br/&gt;	  AND YEAR             = :OLD.YEAR&lt;br/&gt;      AND sader_no      = :OLD.sader_no; &lt;br/&gt;      &lt;br/&gt;      IF counter &lt;&gt; 0    THEN&lt;br/&gt;         UPDATE hrms.employee_decisions&lt;br/&gt;		 SET sader_no = NULL,   sader_date = NULL,  DATE_MODIFIED  =   TO_DATE (TO_CHAR (SYSDATE, &apos;yyyy-mm-dd hh24:mi&apos;),&apos;yyyy-mm-dd hh24:mi&apos;)&lt;br/&gt;         WHERE process_no = :OLD.process_no&lt;br/&gt;		 AND YEAR             = :OLD.YEAR&lt;br/&gt;         AND sader_no      = :OLD.sader_no;&lt;br/&gt;      END IF; &lt;br/&gt;      &lt;br/&gt;     ----------------          Employee_Decisions &lt;br/&gt;     &lt;br/&gt;     ----------------          Vacations&lt;br/&gt;      counter := 0;&lt;br/&gt;       SELECT COUNT (*)        INTO counter&lt;br/&gt;       FROM hrms.vacations&lt;br/&gt;       WHERE process_no = :OLD.process_no&lt;br/&gt;	   AND YEAR             = :OLD.YEAR&lt;br/&gt;       AND sader_no      = :OLD.sader_no;  &lt;br/&gt;       &lt;br/&gt;      IF counter &lt;&gt; 0&lt;br/&gt;      THEN&lt;br/&gt;         UPDATE hrms.vacations            &lt;br/&gt;		          SET sader_no = NULL,   sader_date = NULL,&lt;br/&gt;		                    DATE_MODIFIED  =   TO_DATE (TO_CHAR (SYSDATE, &apos;yyyy-mm-dd hh24:mi&apos;),&apos;yyyy-mm-dd hh24:mi&apos;)&lt;br/&gt;          WHERE process_no = :OLD.process_no&lt;br/&gt;		         AND YEAR             = :OLD.YEAR&lt;br/&gt;                 AND sader_no      = :OLD.sader_no;&lt;br/&gt;      END IF;&lt;br/&gt;     ----------------          Vacations  &lt;br/&gt;     &lt;br/&gt;     ----------------          Temp_Employment&lt;br/&gt;      counter := 0;&lt;br/&gt;       SELECT COUNT (*)   INTO counter&lt;br/&gt;       FROM hrms.temp_employment&lt;br/&gt;       WHERE process_no = :OLD.process_no&lt;br/&gt;	   AND YEAR              = :OLD.YEAR&lt;br/&gt;       AND sader_no        = :OLD.sader_no;&lt;br/&gt;      IF counter &lt;&gt; 0&lt;br/&gt;      THEN&lt;br/&gt;          UPDATE hrms.temp_employment            &lt;br/&gt;		  SET sader_no = NULL,   sader_date = NULL, DATE_MODIFIED  =   TO_DATE (TO_CHAR (SYSDATE, &apos;yyyy-mm-dd hh24:mi&apos;),&apos;yyyy-mm-dd hh24:mi&apos;)&lt;br/&gt;          WHERE process_no = :OLD.process_no&lt;br/&gt;		  AND YEAR    = :OLD.YEAR&lt;br/&gt;          AND sader_no   = :OLD.sader_no;&lt;br/&gt;      END IF;&lt;br/&gt;      &lt;br/&gt;     ----------------   Temp_Employment    &lt;br/&gt;     &lt;br/&gt;     END IF;  ----   if   Deleting &lt;br/&gt;    &lt;br/&gt;   END IF;     ----  IF DBMS_REPUTIL.FROM_REMOTE&lt;br/&gt;   &lt;br/&gt;   EXCEPTION&lt;br/&gt;   When Exec_Sader  then&lt;br/&gt;       raise_application_error(-20001, &apos;?? ?????? ????? ??? ???????? ?????? ?? ???? ????????&apos;); &lt;br/&gt;   WHEN OTHERS&lt;br/&gt;   THEN&lt;br/&gt;      -- Consider logging the error and then re-raise&lt;br/&gt;      RAISE;&lt;br/&gt;  END; </body>
<triggerTime>BEFORE</triggerTime>
<owner>C5730B64-FB4D-9F2E-CCB9-0672373953FB</owner>
<table>B67109F4-FDBC-1061-94D8-288B92E08BE8</table>
</TriggerOraclev10g>