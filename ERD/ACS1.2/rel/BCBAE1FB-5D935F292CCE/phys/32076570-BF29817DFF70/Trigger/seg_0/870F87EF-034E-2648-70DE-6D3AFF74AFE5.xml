<?xml version = '1.0' encoding = 'UTF-8'?>
<TriggerOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.TriggerOraclev10g" name="AUTO_FINISHED" directorySegmentName="seg_0" id="870F87EF-034E-2648-70DE-6D3AFF74AFE5">
<sourceConnName>osd11g</sourceConnName>
<sourceObjSchema>OSD</sourceObjSchema>
<sourceObjName>AUTO_FINISHED</sourceObjName>
<createdBy>Administrator</createdBy>
<createdTime>2014-12-02 09:16:55 UTC</createdTime>
<ownerDesignName>ACS1.1</ownerDesignName>
<actions>INSERT, UPDATE</actions>
<body>declare&lt;br/&gt;&lt;br/&gt;    emp_act_count number;&lt;br/&gt;    v_count       number;&lt;br/&gt;    v_serial      number;&lt;br/&gt;    &lt;br/&gt;begin&lt;br/&gt;  &lt;br/&gt;  select count(*) into v_count&lt;br/&gt;  from  osd.employee_actions&lt;br/&gt;  where process_no = :new.process_no&lt;br/&gt;  and year = :new.year&lt;br/&gt;  and status IS NULL&lt;br/&gt;  and department_no = :new.department_no ;&lt;br/&gt;  &lt;br/&gt;    &lt;br/&gt;    if v_count &gt; 0 then&lt;br/&gt;          &lt;br/&gt;       if inserting then      -- ?? ???? ??????? &lt;br/&gt;           &lt;br/&gt;           update osd.employee_actions &lt;br/&gt;           set finished_date_dd = substr(MAIN.m2h(sysdate),9,2),&lt;br/&gt;               finished_date_mm = substr(MAIN.m2h(sysdate),6,2),&lt;br/&gt;               finished_date_yy = substr(MAIN.m2h(sysdate),1,4),&lt;br/&gt;               action_code = 40, &lt;br/&gt;               STATUS = 2,  --  finished &lt;br/&gt;               site = 10001 -- ??????? ????? &lt;br/&gt;           where process_no = :new.process_no &lt;br/&gt;           and year = :new.year &lt;br/&gt;           and status IS NULL &lt;br/&gt;           and department_no = :new.department_no ;&lt;br/&gt;               &lt;br/&gt;        -----------------------&lt;br/&gt;        &lt;br/&gt;       elsif updating and :new.action_code in (6, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 93, 94, 32) then   -- ?? ????  ?????&lt;br/&gt;       &lt;br/&gt;           update osd.employee_actions &lt;br/&gt;           set finished_date_dd = substr(MAIN.m2h(sysdate),9,2),&lt;br/&gt;               finished_date_mm = substr(MAIN.m2h(sysdate),6,2),&lt;br/&gt;               finished_date_yy = substr(MAIN.m2h(sysdate),1,4),&lt;br/&gt;               action_code = 40, &lt;br/&gt;               status = 2,  --  finished &lt;br/&gt;               site = 10001 -- ??????? ?????  &lt;br/&gt;           where process_no = :new.process_no&lt;br/&gt;           and year = :new.year&lt;br/&gt;           and status is null&lt;br/&gt;           and department_no = :new.department_no ; &lt;br/&gt;        &lt;br/&gt;       end if; &lt;br/&gt;    &lt;br/&gt;    end if;&lt;br/&gt;  &lt;br/&gt;exception &lt;br/&gt;  when no_data_found then null;&lt;br/&gt;end; </body>
<triggerTime>AFTER</triggerTime>
<owner>C5730B64-FB4D-9F2E-CCB9-0672373953FB</owner>
<table>965CB31A-1597-B0A4-E8E3-52FCD080D48B</table>
</TriggerOraclev10g>