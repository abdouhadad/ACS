<?xml version = '1.0' encoding = 'UTF-8'?>
<FunctionOracle class="oracle.dbtools.crest.model.design.storage.oracle.FunctionOracle" name="VALIDATE_RECIVED" directorySegmentName="seg_0" id="A7E09186-B2FE-153B-6E0F-4065A77D8079">
<sourceConnName>osd11g</sourceConnName>
<sourceObjSchema>OSD</sourceObjSchema>
<sourceObjName>VALIDATE_RECIVED</sourceObjName>
<createdBy>Administrator</createdBy>
<createdTime>2014-12-02 09:16:58 UTC</createdTime>
<ownerDesignName>ACS1.1</ownerDesignName>
<owner>C5730B64-FB4D-9F2E-CCB9-0672373953FB</owner>
<source>CREATE OR REPLACE function     OSD.VALIDATE_RECIVED (p_process number, p_user_id number) return number  IS&lt;br/&gt;&lt;br/&gt;    v_serial       number;&lt;br/&gt;    v_rec_flag     number;&lt;br/&gt;    v_to_dept      number;&lt;br/&gt;    v_value        number;&lt;br/&gt;    v_exist        number;&lt;br/&gt;    &lt;br/&gt;    cursor cur is select * &lt;br/&gt;                  from main.all_user_sp_dept &lt;br/&gt;                  where user_no = p_user_id;&lt;br/&gt;    /*             &lt;br/&gt;    -- this function to return value in ( 0, 1, 2, 3) according to auto_recieved value:&lt;br/&gt;    -- 0  not recieved &lt;br/&gt;    -- 1  recieved     &lt;br/&gt;    -- 2  recieved + have privilege &lt;br/&gt;    -- 3  recieved + don&apos;t have privilege   &lt;br/&gt;    */    &lt;br/&gt;       &lt;br/&gt;begin&lt;br/&gt;  ------------------------------------- check recieved  ----------------------------------&lt;br/&gt;  select max(serial_no) into v_serial&lt;br/&gt;  from   osd.AUTO_RECIEVED&lt;br/&gt;  where  process_no = p_process;&lt;br/&gt;  &lt;br/&gt;  select to_dept, rec_flag into v_to_dept, v_rec_flag&lt;br/&gt;  from   osd.AUTO_RECIEVED&lt;br/&gt;  where  process_no = p_process&lt;br/&gt;  and      serial_no = v_serial;&lt;br/&gt;  &lt;br/&gt;  if  v_rec_flag = 0 then&lt;br/&gt;  &lt;br/&gt;    v_value := 0 ;&lt;br/&gt;    &lt;br/&gt;  &lt;br/&gt;  elsif v_rec_flag = 1 then&lt;br/&gt;  &lt;br/&gt;    v_value := 1 ;&lt;br/&gt;    &lt;br/&gt;      -------------------------------- To approve if have privilege --------------------------&lt;br/&gt;        for i in cur loop &lt;br/&gt;        &lt;br/&gt;          if v_to_dept = i.dept_no then&lt;br/&gt;              v_value := 2;&lt;br/&gt;              exit;&lt;br/&gt;          else&lt;br/&gt;              v_value := 3; &lt;br/&gt;          end if;&lt;br/&gt;          &lt;br/&gt;        end loop;&lt;br/&gt;        &lt;br/&gt;  end if; &lt;br/&gt;    &lt;br/&gt;   return v_value;  &lt;br/&gt;    &lt;br/&gt;exception&lt;br/&gt;     when no_data_found then &lt;br/&gt;       raise;&lt;br/&gt;END;</source>
</FunctionOracle>